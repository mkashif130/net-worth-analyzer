<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AED Net Worth & Retirement — Single File</title>
<style>
  :root{
    --bg:#0c1020;--card:#121735;--ink:#e8f0ff;--muted:#9fb0d9;--line:#1e2a54;
    --accent:#6ea8ff;--ok:#2ec27e;--warn:#f6c445;--bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:500 15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  h1,h2,h3{margin:0 0 .6rem}
  h1{font-size:1.35rem}
  h2{font-size:1.05rem;color:#d7e6ff}
  h3{font-size:.95rem;color:var(--muted)}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  .card{background:linear-gradient(180deg,var(--card),#0f1530);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 12px 26px #00000033}
  .grid{display:grid;gap:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row>div{flex:1 1 220px}
  label{display:block;font-size:.82rem;color:var(--muted);margin:4px 0 6px}
  input,select,button,textarea{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid #293568;background:#0f1530;color:var(--ink);
    outline:none;transition:.15s border,.15s box-shadow;font:inherit
  }
  input:focus,select:focus,textarea:focus{border-color:#4f6cc8;box-shadow:0 0 0 3px #3b5ccc55}
  button{cursor:pointer;background:linear-gradient(180deg,#2b61ff,#2149c9);border:1px solid #183bb0}
  button.secondary{background:#1a2347;border-color:#2a396e}
  .muted{color:var(--muted)}
  .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .stat{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid #223264;border-radius:12px;background:#0e1530}
  .stat strong{font-size:1.1rem}
  .table{width:100%;border-collapse:collapse;margin-top:8px;font-variant-numeric:tabular-nums}
  .table th,.table td{border-bottom:1px dashed #294173;padding:8px;text-align:right}
  .table th:first-child,.table td:first-child{text-align:left}
  canvas{background:#0a1024;border:1px solid var(--line);border-radius:12px}
  .foot{color:#7f95c7;font-size:.82rem;margin-top:10px}
  .tag{border:1px solid #2a3a6b;background:#12204a;padding:2px 8px;border-radius:999px;font-size:.75rem}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .hide{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>AED Net Worth & Retirement Planner (Single File)</h1>

  <!-- STEP 1: INPUTS -->
  <section id="inputs" class="card" style="margin-top:12px">
    <h2>Step 1 — Enter your numbers (AED only)</h2>
    <div class="row" style="margin-top:8px">
      <div>
        <label>Stocks / ETFs (AED)</label>
        <input id="stocksAed" type="number" step="1" placeholder="e.g., 124780">
      </div>
      <div>
        <label>Cash (AED)</label>
        <input id="cashAed" type="number" step="1" placeholder="e.g., 10000">
      </div>
      <div>
        <label>Emergency Fund (AED)</label>
        <input id="efAed" type="number" step="1" placeholder="e.g., 300000">
      </div>
    </div>

    <h3 style="margin-top:10px">Properties (AED)</h3>
    <div id="propList" class="grid"></div>
    <div class="row" style="margin-top:6px">
      <div style="flex:0 0 auto"><button id="addProp" type="button" class="secondary">+ Add Property</button></div>
    </div>

    <h3 style="margin-top:12px">Liabilities</h3>
    <div class="row">
      <div>
        <label>Total Liabilities (AED)</label>
        <input id="liabAed" type="number" step="1" placeholder="e.g., 172000">
      </div>
      <div>
        <label>Years to Pay Off Liabilities (linear)</label>
        <input id="liabYears" type="number" step="1" value="4">
      </div>
    </div>

    <h2 style="margin-top:16px">Projection</h2>
    <div class="row">
      <div>
        <label>Monthly Investment into Stocks (AED)</label>
        <input id="monthlyAed" type="number" step="1" value="5000">
      </div>
      <div>
        <label>Semiannual Investment (AED)</label>
        <input id="semiAed" type="number" step="1" value="95420" />
      </div>
      <div>
        <label>Semiannual Investments Until (Year)</label>
        <input id="semiUntil" type="number" step="1" value="2028">
      </div>
    </div>
    <div class="row">
      <div>
        <label>Expected Annual Return (%)</label>
        <input id="retPct" type="number" step="0.1" value="8">
      </div>
      <div>
        <label>Dividend Yield (%)</label>
        <input id="divPct" type="number" step="0.1" value="3">
      </div>
      <div>
        <label>Projection Horizon</label>
        <select id="horizon"></select>
      </div>
    </div>

    <h2 style="margin-top:16px">Retirement Check</h2>
    <div class="row">
      <div>
        <label>Target Yearly Spend (AED)</label>
        <input id="retSpend" type="number" step="1" placeholder="e.g., 240000">
      </div>
      <div>
        <label>Safe Withdrawal Rate (%)</label>
        <input id="swr" type="number" step="0.1" value="4">
      </div>
      <div>
        <label>Include Property in Retirement?</label>
        <select id="includeProp">
          <option value="no">No (liquid assets only)</option>
          <option value="half">Yes, 50% haircut</option>
          <option value="yes">Yes, full value</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <div style="flex:0 0 auto">
        <button id="calcBtn" type="button">Calculate</button>
      </div>
      <div style="flex:1 1 auto;display:flex;align-items:center;gap:8px">
        <span id="saveBadge" class="tag">autosaved ✓</span>
        <span class="muted" style="font-size:.85rem">Inputs autosave locally</span>
      </div>
      <div style="flex:0 0 auto">
        <button id="resetBtn" class="secondary" type="button">Reset</button>
      </div>
    </div>
  </section>

  <!-- STEP 2: RESULTS (HIDDEN UNTIL CALC) -->
  <section id="results" class="card hide" style="margin-top:12px">
    <h2>Results</h2>

    <div class="kpis" style="margin-top:10px">
      <div class="stat"><span class="muted">Total Assets</span><strong id="assetsAED">–</strong></div>
      <div class="stat"><span class="muted">Liabilities</span><strong id="liabOut">–</strong></div>
      <div class="stat"><span class="muted">Net Worth</span><strong id="nwAED">–</strong></div>
      <div class="stat"><span class="muted">Horizon</span><strong id="hzOut">–</strong></div>
    </div>

    <canvas id="chart" height="180" style="margin-top:12px"></canvas>

    <h3 style="margin-top:14px">Projection Table</h3>
    <table class="table" id="projTable">
      <thead><tr>
        <th>Year</th>
        <th>Stocks (AED)</th>
        <th>Dividends (AED)</th>
        <th>Properties (AED)</th>
        <th>Cash+EF (AED)</th>
        <th>Liabilities (AED)</th>
        <th>Net Worth (AED)</th>
      </tr></thead>
      <tbody></tbody>
    </table>

    <h3 style="margin-top:14px">Retirement Snapshot</h3>
    <div id="retirement"></div>

    <div class="foot">This simple tool is for planning & education. Markets vary; verify numbers before decisions.</div>
  </section>
</div>

<script>
/* ===== Utilities ===== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const fmt = n => (n===null||isNaN(n)) ? "–" : n.toLocaleString(undefined,{maximumFractionDigits:0});
const fmt2 = n => (n===null||isNaN(n)) ? "–" : n.toLocaleString(undefined,{maximumFractionDigits:2});
const YEAR0 = (new Date()).getFullYear();

/* ===== State (autosave) ===== */
function readNum(id){ const v=parseFloat($(id).value); return isNaN(v)?0:v; }
function getProps(){
  return $$("#propList .prop").map(el => parseFloat(el.querySelector("input").value||"0")||0);
}
function setProps(list){
  const box = $("#propList"); box.innerHTML = "";
  list.forEach(v => addProp(v));
}
function addProp(v=0){
  const row = document.createElement("div");
  row.className = "prop";
  row.innerHTML = `
    <div class="row">
      <div><input type="number" step="1" placeholder="e.g., 666667" value="${v||""}"></div>
      <div style="flex:0 0 auto"><button type="button" class="secondary del">✕</button></div>
    </div>`;
  row.querySelector(".del").onclick = () => { row.remove(); saveState(); };
  row.querySelector("input").oninput = saveState;
  $("#propList").appendChild(row);
}
$("#addProp").onclick = () => { addProp(0); saveState(); };

function saveState(){
  const s = {
    stocksAed: readNum("#stocksAed"),
    cashAed: readNum("#cashAed"),
    efAed: readNum("#efAed"),
    liabAed: readNum("#liabAed"),
    liabYears: readNum("#liabYears"),
    monthlyAed: readNum("#monthlyAed"),
    semiAed: readNum("#semiAed"),
    semiUntil: readNum("#semiUntil"),
    retPct: readNum("#retPct"),
    divPct: readNum("#divPct"),
    horizon: $("#horizon").value,
    retSpend: readNum("#retSpend"),
    swr: readNum("#swr"),
    includeProp: $("#includeProp").value,
    props: getProps()
  };
  localStorage.setItem("aed_nw_v1", JSON.stringify(s));
  $("#saveBadge").textContent = "autosaved ✓";
}
function loadState(){
  const s = JSON.parse(localStorage.getItem("aed_nw_v1")||"null");
  setHorizonOptions();
  if(!s){
    // sensible defaults (your case)
    $("#stocksAed").value = 124780;
    $("#cashAed").value = 10000;
    $("#efAed").value = 300000;
    $("#liabAed").value = 172000;
    $("#liabYears").value = 4;
    $("#monthlyAed").value = 5000;
    $("#semiAed").value = 95420; // ~26k USD * 3.67 as AED
    $("#semiUntil").value = 2028;
    $("#retPct").value = 8;
    $("#divPct").value = 3;
    $("#retSpend").value = 240000;
    $("#swr").value = 4;
    $("#includeProp").value = "no";
    $("#horizon").value = "5";
    setProps([666667,400000,173333,40000]); // your properties as AED examples
    return;
  }
  $("#stocksAed").value = s.stocksAed||0;
  $("#cashAed").value = s.cashAed||0;
  $("#efAed").value = s.efAed||0;
  $("#liabAed").value = s.liabAed||0;
  $("#liabYears").value = s.liabYears||4;
  $("#monthlyAed").value = s.monthlyAed||0;
  $("#semiAed").value = s.semiAed||0;
  $("#semiUntil").value = s.semiUntil||YEAR0+3;
  $("#retPct").value = s.retPct||8;
  $("#divPct").value = s.divPct||3;
  $("#retSpend").value = s.retSpend||0;
  $("#swr").value = s.swr||4;
  $("#includeProp").value = s.includeProp||"no";
  $("#horizon").value = s.horizon||"5";
  setProps(s.props && s.props.length ? s.props : []);
}
function setHorizonOptions(){
  const sel=$("#horizon"); sel.innerHTML="";
  for(let y=5; y<=80; y+=5){
    const o=document.createElement("option");
    o.value=String(y); o.textContent=`${y} years`;
    sel.appendChild(o);
  }
}

/* ===== Calculation ===== */
function calcAll(){
  const stocks = readNum("#stocksAed");
  const cash = readNum("#cashAed");
  const ef = readNum("#efAed");
  const props = getProps().reduce((s,v)=>s+(v||0),0);
  const liab0 = readNum("#liabAed");
  const liabYears = Math.max(0, readNum("#liabYears"));

  const assetsNow = stocks + cash + ef + props;
  const netNow = assetsNow - liab0;

  // projection settings
  const mAed = readNum("#monthlyAed");
  const semiAed = readNum("#semiAed");
  const semiUntil = readNum("#semiUntil");
  const r = readNum("#retPct")/100;
  const dy = readNum("#divPct")/100;
  const horizon = parseInt($("#horizon").value,10);

  // series
  let st = stocks, pr = props, cs = cash + ef, li = liab0;
  const liabSteps = (liabYears>0) ? Math.min(liabYears, horizon) : 0;
  const liDrop = liabSteps ? (li/liabSteps) : 0;

  const rows = [];
  const labels = [], netSeries=[];
  let year = YEAR0;

  for(let i=1;i<=horizon;i++){
    const y = year + i - 1;
    // contributions
    const semi = (y <= semiUntil) ? (2*semiAed) : 0;
    const contrib = semi + mAed*12;
    st += contrib;

    // dividends before growth
    const divs = st * dy;

    // growth
    st *= (1 + r);

    // liabilities paydown
    if(i<=liabSteps){ li = Math.max(0, li - liDrop); } else { li = 0; }

    const totalAssets = st + pr + cs;
    const nw = totalAssets - li;

    rows.push({y, st:Math.round(st), divs:Math.round(divs), pr:Math.round(pr), cs:Math.round(cs), li:Math.round(li), nw:Math.round(nw)});
    labels.push(String(y)); netSeries.push(nw);
  }

  // Fill KPIs
  $("#assetsAED").textContent = fmt(assetsNow) + " AED";
  $("#liabOut").textContent = fmt(liab0) + " AED";
  $("#nwAED").textContent = fmt(netNow) + " AED";
  $("#hzOut").textContent = $("#horizon").value + "y";

  // Table
  const tb=$("#projTable tbody"); tb.innerHTML="";
  rows.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML = `
      <td>${r.y}</td>
      <td>${fmt(r.st)}</td>
      <td>${fmt(r.divs)}</td>
      <td>${fmt(r.pr)}</td>
      <td>${fmt(r.cs)}</td>
      <td>${fmt(r.li)}</td>
      <td><strong>${fmt(r.nw)}</strong></td>
    `;
    tb.appendChild(tr);
  });

  // Chart
  drawLineChart($("#chart"), labels, netSeries);

  // Retirement snapshot (use end-of-horizon net)
  retirement(rows.at(-1)?.nw ?? netNow, pr);
}

function retirement(projectedNet, propertyAed){
  const spend = readNum("#retSpend");
  const swr = readNum("#swr")/100;
  const includeProp = $("#includeProp").value;

  // Allowed property fraction
  let propFactor = 0;
  if(includeProp==="yes") propFactor = 1;
  if(includeProp==="half") propFactor = 0.5;

  const withdrawalBase = projectedNet - propertyAed + propertyAed*propFactor;
  const swrIncome = withdrawalBase * swr;

  // Estimate dividends as 3% of ~35% of withdrawal base (rough proxy for stock share)
  const divIncome = withdrawalBase * 0.35 * (readNum("#divPct")/100);

  const ok = (swrIncome + divIncome) >= spend;
  const statusClass = ok ? "ok" : ((swrIncome + divIncome) > 0.8*spend ? "warn" : "bad");
  const statusText = ok ? "On track ✅" : ((swrIncome + divIncome) > 0.8*spend ? "Close — needs tweaks ⚠️" : "Shortfall ⛔");

  $("#retirement").innerHTML = `
    <div class="kpis" style="margin-top:8px">
      <div class="stat"><span class="muted">Projected Net @ Horizon</span><strong>${fmt(projectedNet)} AED</strong></div>
      <div class="stat"><span class="muted">Withdrawal Base</span><strong>${fmt(Math.round(withdrawalBase))} AED</strong></div>
      <div class="stat"><span class="muted">SWR Income</span><strong>${fmt(Math.round(swrIncome))} AED/yr</strong></div>
      <div class="stat"><span class="muted">Est. Dividends</span><strong>${fmt(Math.round(divIncome))} AED/yr</strong></div>
    </div>
    <div class="muted" style="margin-top:8px">Target spend: <strong>${fmt(spend)} AED/yr</strong> — <span class="${statusClass}"><strong>${statusText}</strong></span></div>
  `;
}

/* ===== Chart (no libs) ===== */
function drawLineChart(canvas, labels, series){
  const ctx = canvas.getContext("2d");
  const w = canvas.width = canvas.clientWidth;
  const h = canvas.height = canvas.clientHeight;
  ctx.fillStyle="#0a1024"; ctx.fillRect(0,0,w,h);
  const padL=44,padR=10,padT=10,padB=22;
  const iw=w-padL-padR, ih=h-padT-padB;

  const min=Math.min(...series), max=Math.max(...series);
  const lo=min*0.95, hi=max*1.05;
  const sx=i=> padL + (i/(series.length-1))*iw;
  const sy=v=> padT + ih - ((v-lo)/(hi-lo))*ih;

  // grid
  ctx.strokeStyle="#20305d"; ctx.lineWidth=1; ctx.beginPath();
  for(let i=0;i<=4;i++){ const y=padT+(i/4)*ih; ctx.moveTo(padL,y); ctx.lineTo(w-padR,y); }
  ctx.stroke();

  // y labels
  ctx.fillStyle="#9fb0d9"; ctx.font="11px system-ui";
  for(let i=0;i<=4;i++){ const val=lo+(i/4)*(hi-lo); ctx.fillText(fmt(Math.round(val)), 6, padT+(1-i/4)*ih+4); }

  // x labels (sparse)
  const step = Math.max(1, Math.floor(labels.length/6));
  labels.forEach((lab,i)=>{ if(i%step===0 || i===labels.length-1){ ctx.fillText(lab, sx(i)-8, h-6); } });

  // line
  ctx.strokeStyle="#6ea8ff"; ctx.lineWidth=2; ctx.beginPath();
  series.forEach((v,i)=>{ const x=sx(i), y=sy(v); i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
  ctx.stroke();

  // dots
  ctx.fillStyle="#6ea8ff";
  series.forEach((v,i)=>{ const x=sx(i), y=sy(v); ctx.beginPath(); ctx.arc(x,y,2.5,0,Math.PI*2); ctx.fill(); });
}

/* ===== Events ===== */
$("#calcBtn").onclick = () => {
  calcAll();
  $("#results").classList.remove("hide");
  // scroll to results
  $("#results").scrollIntoView({behavior:"smooth", block:"start"});
};
$("#resetBtn").onclick = () => { localStorage.removeItem("aed_nw_v1"); location.reload(); };
["input","change"].forEach(ev=>{
  document.body.addEventListener(ev, e=>{
    if(["INPUT","SELECT","TEXTAREA"].includes(e.target.tagName)){
      $("#saveBadge").textContent="saving…";
      clearTimeout(window.__saveT); window.__saveT=setTimeout(saveState, 250);
    }
  });
});

/* ===== Boot ===== */
(function init(){
  loadState();
})();
</script>
</body>
</html>
