<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AED Net Worth Planner — Wizard</title>
<style>
  :root{
    --bg:#0d111a;--card:#111826;--ink:#eaf1ff;--muted:#9ab0d2;--line:#1d2a44;--accent:#6ea8ff;
    --ok:#2ec27e;--warn:#f6c445;--bad:#ff6b6b;--chip:#142038
  }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font:500 15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  h1,h2,h3{margin:0 0 .5rem} h1{font-size:1.3rem} h2{font-size:1.05rem;color:#d7e5ff} h3{font-size:.95rem;color:var(--muted)}
  .wrap{max-width:860px;margin:26px auto;padding:0 16px}
  .card{background:linear-gradient(180deg,var(--card),#0e1628);border:1px solid var(--line);border-radius:14px;padding:18px;box-shadow:0 12px 26px #00000033}
  .row{display:flex;gap:10px;flex-wrap:wrap} .row>div{flex:1 1 240px;min-width:220px}
  label{display:block;font-size:.84rem;color:var(--muted);margin:4px 0 6px}
  input,select,button,textarea{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid #293a66;background:#0f1730;color:var(--ink);
    outline:none;transition:.15s border,.15s box-shadow;font:inherit
  }
  input:focus,select:focus,textarea:focus{border-color:#4f6cc8;box-shadow:0 0 0 3px #3b5ccc55}
  button{cursor:pointer;background:linear-gradient(180deg,#2b61ff,#2149c9);border:1px solid #183bb0}
  button.ghost{background:#141c33;border-color:#263a73}
  .muted{color:var(--muted)} .small{font-size:.82rem}
  .help{font-size:.85rem;color:#a6b7dc;margin-top:4px}
  .pill{display:inline-flex;gap:8px;align-items:center;background:var(--chip);border:1px solid #223565;color:#cfe0ff;padding:6px 10px;border-radius:999px}
  .footerBtns{display:flex;justify-content:space-between;gap:10px;margin-top:14px}
  .progress{height:6px;background:#0c142a;border-radius:999px;overflow:hidden;margin:8px 0 16px;border:1px solid #1a2952}
  .bar{height:100%;background:#5e96ff;width:0%;transition:width .25s ease}
  .hide{display:none}
  .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .stat{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid #223264;border-radius:12px;background:#0f1630}
  .stat strong{font-size:1.1rem}
  .table{width:100%;border-collapse:collapse;margin-top:8px;font-variant-numeric:tabular-nums}
  .table th,.table td{border-bottom:1px dashed #294173;padding:8px;text-align:right}
  .table th:first-child,.table td:first-child{text-align:left}
  canvas{background:#0a1024;border:1px solid var(--line);border-radius:12px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
</style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
    <h1>AED Net Worth & Retirement Planner</h1>
    <span class="pill small">Step-by-step • Single file</span>
  </div>
  <div class="progress"><div class="bar" id="bar"></div></div>

  <!-- STEP 1: ASSETS -->
  <section class="card step" data-step="1">
    <h2>Step 1 — Assets (AED)</h2>
    <p class="help">Enter what you own. Keep it rough; you can refine later.</p>
    <div class="row">
      <div><label>Stocks / ETFs</label><input id="stocks" type="number" step="1" placeholder="e.g., 124780"></div>
      <div><label>Cash</label><input id="cash" type="number" step="1" placeholder="e.g., 10000"></div>
      <div><label>Emergency Fund</label><input id="ef" type="number" step="1" placeholder="e.g., 300000"></div>
    </div>
    <h3 style="margin-top:8px">Properties</h3>
    <div id="propList"></div>
    <div class="row" style="margin-top:6px">
      <div style="flex:0 0 auto"><button id="addProp" type="button" class="ghost">+ Add Property</button></div>
    </div>
    <div class="footerBtns">
      <button class="ghost" disabled>Back</button>
      <button id="next1">Next</button>
    </div>
  </section>

  <!-- STEP 2: LIABILITIES -->
  <section class="card step hide" data-step="2">
    <h2>Step 2 — Liabilities (AED)</h2>
    <p class="help">What you owe. We’ll assume a simple straight-line payoff.</p>
    <div class="row">
      <div><label>Total Liabilities</label><input id="liab" type="number" step="1" placeholder="e.g., 172000"></div>
      <div><label>Years to Pay Off (linear)</label><input id="liabYears" type="number" step="1" value="4"></div>
    </div>
    <div class="footerBtns">
      <button class="ghost" data-back>Back</button>
      <button id="next2">Next</button>
    </div>
  </section>

  <!-- STEP 3: PROJECTION -->
  <section class="card step hide" data-step="3">
    <h2>Step 3 — Projection Settings</h2>
    <p class="help">How you’ll invest going forward.</p>
    <div class="row">
      <div><label>Monthly Investment (AED)</label><input id="monthly" type="number" step="1" value="5000"></div>
      <div><label>Semiannual Investment (AED)</label><input id="semi" type="number" step="1" value="95420"></div>
      <div><label>Semiannual Investments Until (Year)</label><input id="semiUntil" type="number" step="1" value="2028"></div>
    </div>
    <div class="row">
      <div><label>Expected Annual Return (%)</label><input id="retPct" type="number" step="0.1" value="8"></div>
      <div><label>Dividend Yield (%)</label><input id="divPct" type="number" step="0.1" value="3"></div>
      <div>
        <label>Projection Horizon</label>
        <select id="horizon"></select>
      </div>
    </div>
    <div class="footerBtns">
      <button class="ghost" data-back>Back</button>
      <button id="next3">Next</button>
    </div>
  </section>

  <!-- STEP 4: RETIREMENT -->
  <section class="card step hide" data-step="4">
    <h2>Step 4 — Retirement Preferences</h2>
    <p class="help">Check if you’re on track vs. your yearly spending target.</p>
    <div class="row">
      <div><label>Target Yearly Spend (AED)</label><input id="retSpend" type="number" step="1" placeholder="e.g., 240000"></div>
      <div><label>Safe Withdrawal Rate (%)</label><input id="swr" type="number" step="0.1" value="4"></div>
      <div>
        <label>Include Property for Withdrawals?</label>
        <select id="includeProp">
          <option value="no">No (liquid only)</option>
          <option value="half">Yes, count 50%</option>
          <option value="yes">Yes, count 100%</option>
        </select>
      </div>
    </div>
    <div class="footerBtns">
      <button class="ghost" data-back>Back</button>
      <button id="calc">Calculate</button>
    </div>
  </section>

  <!-- STEP 5: RESULTS -->
  <section class="card hide" id="results">
    <h2>Results</h2>
    <div class="kpis" style="margin-top:10px">
      <div class="stat"><span class="muted">Total Assets</span><strong id="assetsAED">–</strong></div>
      <div class="stat"><span class="muted">Liabilities</span><strong id="liabOut">–</strong></div>
      <div class="stat"><span class="muted">Net Worth</span><strong id="nwAED">–</strong></div>
      <div class="stat"><span class="muted">Horizon</span><strong id="hzOut">–</strong></div>
    </div>

    <canvas id="chart" height="180" style="margin-top:12px"></canvas>

    <h3 style="margin-top:14px">Projection (last year first)</h3>
    <table class="table" id="projTable">
      <thead><tr>
        <th>Year</th><th>Stocks</th><th>Dividends</th><th>Properties</th><th>Cash+EF</th><th>Liabilities</th><th>Net Worth</th>
      </tr></thead>
      <tbody></tbody>
    </table>

    <h3 style="margin-top:14px">Retirement Snapshot</h3>
    <div id="retirement"></div>

    <div class="footerBtns" style="margin-top:16px">
      <button class="ghost" id="editAgain">← Edit inputs</button>
      <button class="ghost" id="reset">Reset</button>
    </div>
  </section>
</div>

<script>
/* ===== Utilities ===== */
const $  = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const fmt  = n => (n===null||isNaN(n)) ? "–" : n.toLocaleString(undefined,{maximumFractionDigits:0});
const YEAR0 = (new Date()).getFullYear();

/* ===== Wizard ===== */
const steps = $$(".step");
let cur = 1;
function setProgress(){ $("#bar").style.width = ((cur-1)/(steps.length))*100 + "%"; }
function showStep(n){
  cur = n;
  steps.forEach(s => s.classList.toggle("hide", parseInt(s.dataset.step,10)!==n));
  $("#results")?.classList.add("hide");
  setProgress();
}
$$("[data-back]").forEach(b=> b.addEventListener("click", ()=> showStep(cur-1)));
$("#next1").onclick = ()=> showStep(2);
$("#next2").onclick = ()=> showStep(3);
$("#next3").onclick = ()=> showStep(4);

/* ===== Properties UI ===== */
function propRow(v=0){
  const wrap = document.createElement("div");
  wrap.className = "row"; wrap.style.marginTop = "6px";
  wrap.innerHTML = `
    <div><input type="number" step="1" placeholder="e.g., 666667" value="${v||""}"></div>
    <div style="flex:0 0 auto"><button type="button" class="ghost del">✕</button></div>`;
  wrap.querySelector(".del").onclick = ()=>{ wrap.remove(); save(); };
  wrap.querySelector("input").oninput = save;
  return wrap;
}
$("#addProp").onclick = ()=> { $("#propList").appendChild(propRow(0)); save(); };

/* ===== State & Defaults ===== */
function setHorizonOptions(){
  const sel=$("#horizon"); sel.innerHTML="";
  for(let y=5;y<=80;y+=5){
    const o=document.createElement("option"); o.value=String(y); o.textContent=`${y} years`; sel.appendChild(o);
  }
}
setHorizonOptions();

function save(){
  const s = {
    stocks: +($("#stocks").value||0),
    cash: +($("#cash").value||0),
    ef: +($("#ef").value||0),
    liab: +($("#liab").value||0),
    liabYears: +($("#liabYears").value||4),
    monthly: +($("#monthly").value||0),
    semi: +($("#semi").value||0),
    semiUntil: +($("#semiUntil").value||YEAR0+3),
    retPct: +($("#retPct").value||8),
    divPct: +($("#divPct").value||3),
    horizon: +($("#horizon").value||5),
    retSpend: +($("#retSpend").value||0),
    swr: +($("#swr").value||4),
    includeProp: $("#includeProp").value,
    props: $$("#propList .row input").map(i=>+(i.value||0))
  };
  localStorage.setItem("wizard_aed_v1", JSON.stringify(s));
}
function load(){
  const s = JSON.parse(localStorage.getItem("wizard_aed_v1")||"null");
  if(!s){
    // sensible defaults (your case)
    $("#stocks").value = 124780; $("#cash").value = 10000; $("#ef").value = 300000;
    $("#liab").value = 172000; $("#liabYears").value = 4;
    $("#monthly").value = 5000; $("#semi").value = 95420; $("#semiUntil").value = 2028;
    $("#retPct").value = 8; $("#divPct").value = 3; $("#horizon").value = 5;
    $("#retSpend").value = 240000; $("#swr").value = 4; $("#includeProp").value = "no";
    // properties as AED examples
    [666667,400000,173333,40000].forEach(v=> $("#propList").appendChild(propRow(v)));
    return;
  }
  $("#stocks").value = s.stocks||0; $("#cash").value=s.cash||0; $("#ef").value=s.ef||0;
  $("#liab").value=s.liab||0; $("#liabYears").value=s.liabYears||4;
  $("#monthly").value=s.monthly||0; $("#semi").value=s.semi||0; $("#semiUntil").value=s.semiUntil||YEAR0+3;
  $("#retPct").value=s.retPct||8; $("#divPct").value=s.divPct||3; $("#horizon").value=String(s.horizon||5);
  $("#retSpend").value=s.retSpend||0; $("#swr").value=s.swr||4; $("#includeProp").value=s.includeProp||"no";
  (s.props && s.props.length ? s.props : []).forEach(v=> $("#propList").appendChild(propRow(v)));
}
["input","change"].forEach(ev=>{
  document.body.addEventListener(ev, e=>{
    if(["INPUT","SELECT","TEXTAREA"].includes(e.target.tagName)) save();
  });
});

/* ===== Core Calculation ===== */
function calculate(){
  const stocks = +($("#stocks").value||0);
  const cash = +($("#cash").value||0);
  const ef = +($("#ef").value||0);
  const props = $$("#propList .row input").reduce((s,i)=> s + (+i.value||0), 0);

  const liab0 = +($("#liab").value||0);
  const liYears = Math.max(0, +($("#liabYears").value||0));

  const monthly = +($("#monthly").value||0);
  const semi = +($("#semi").value||0);
  const semiUntil = +($("#semiUntil").value||YEAR0+3);
  const ret = (+($("#retPct").value||0))/100;
  const div = (+($("#divPct").value||0))/100;
  const horizon = parseInt($("#horizon").value,10);

  const assetsNow = stocks + cash + ef + props;
  const netNow = assetsNow - liab0;

  // series
  let st=stocks, pr=props, cs=cash+ef, li=liab0;
  const liSteps = liYears ? Math.min(liYears, horizon) : 0;
  const liDrop = liSteps ? (li/liSteps) : 0;

  const rows = []; const labels=[]; const netSeries=[];
  for(let i=1;i<=horizon;i++){
    const y = YEAR0 + i - 1;
    const semiAdd = (y<=semiUntil) ? 2*semi : 0;
    const contrib = semiAdd + monthly*12;
    st += contrib;

    const dividends = st * div;   // before growth
    st *= (1 + ret);              // grow

    if(i<=liSteps){ li = Math.max(0, li - liDrop); } else { li = 0; }

    const totalAssets = st + pr + cs;
    const nw = totalAssets - li;

    rows.push({y, st:Math.round(st), divs:Math.round(dividends), pr:Math.round(pr), cs:Math.round(cs), li:Math.round(li), nw:Math.round(nw)});
    labels.push(String(y)); netSeries.push(nw);
  }

  // KPIs
  $("#assetsAED").textContent = fmt(assetsNow) + " AED";
  $("#liabOut").textContent   = fmt(liab0) + " AED";
  $("#nwAED").textContent     = fmt(netNow) + " AED";
  $("#hzOut").textContent     = horizon + "y";

  // Table (show last year first for quick takeaway)
  const tb=$("#projTable tbody"); tb.innerHTML="";
  rows.slice().reverse().forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML = `<td>${r.y}</td><td>${fmt(r.st)}</td><td>${fmt(r.divs)}</td><td>${fmt(r.pr)}</td><td>${fmt(r.cs)}</td><td>${fmt(r.li)}</td><td><strong>${fmt(r.nw)}</strong></td>`;
    tb.appendChild(tr);
  });

  drawChart($("#chart"), labels, netSeries);
  retirement(rows.at(-1)?.nw ?? netNow, pr);

  $("#results").classList.remove("hide");
  showStep(steps.length); // progress to full
}

function retirement(projectedNet, propertyAed){
  const spend = +($("#retSpend").value||0);
  const swr   = (+($("#swr").value||4))/100;
  const mode  = $("#includeProp").value;

  let propFactor = 0; if(mode==="half") propFactor=.5; if(mode==="yes") propFactor=1;
  const withdrawalBase = projectedNet - propertyAed + propertyAed*propFactor;
  const swrIncome = withdrawalBase * swr;

  // simple dividend proxy: 35% of base × dividend yield
  const divIncome = withdrawalBase * 0.35 * ((+($("#divPct").value||3))/100);

  const ok = (swrIncome + divIncome) >= spend;
  const cls = ok ? "ok" : ((swrIncome+divIncome)>0.8*spend ? "warn" : "bad");
  const txt = ok ? "On track ✅" : ((swrIncome+divIncome)>0.8*spend ? "Close — needs tweaks ⚠️" : "Shortfall ⛔");

  $("#retirement").innerHTML = `
    <div class="kpis" style="margin-top:8px">
      <div class="stat"><span class="muted">Projected Net @ Horizon</span><strong>${fmt(projectedNet)} AED</strong></div>
      <div class="stat"><span class="muted">Withdrawal Base</span><strong>${fmt(Math.round(withdrawalBase))} AED</strong></div>
      <div class="stat"><span class="muted">SWR Income</span><strong>${fmt(Math.round(swrIncome))} AED/yr</strong></div>
      <div class="stat"><span class="muted">Est. Dividends</span><strong>${fmt(Math.round(divIncome))} AED/yr</strong></div>
    </div>
    <p class="muted" style="margin-top:8px">Target spend: <strong>${fmt(spend)} AED/yr</strong> — <span class="${cls}"><strong>${txt}</strong></span></p>
  `;
}

/* ===== Chart (no libs) ===== */
function drawChart(canvas, labels, series){
  const ctx = canvas.getContext("2d");
  const w = canvas.width = canvas.clientWidth;
  const h = canvas.height = canvas.clientHeight;
  ctx.fillStyle="#0a1024"; ctx.fillRect(0,0,w,h);
  const padL=44,padR=10,padT=10,padB=22;
  const iw=w-padL-padR, ih=h-padT-padB;

  const min=Math.min(...series), max=Math.max(...series);
  const lo=min*0.95, hi=max*1.05;
  const sx=i=> padL + (i/(series.length-1))*iw;
  const sy=v=> padT + ih - ((v-lo)/(hi-lo))*ih;

  // grid
  ctx.strokeStyle="#20305d"; ctx.lineWidth=1; ctx.beginPath();
  for(let i=0;i<=4;i++){ const y=padT+(i/4)*ih; ctx.moveTo(padL,y); ctx.lineTo(w-padR,y); }
  ctx.stroke();

  // y labels
  ctx.fillStyle="#9fb0d9"; ctx.font="11px system-ui";
  for(let i=0;i<=4;i++){ const val=lo+(i/4)*(hi-lo); ctx.fillText(fmt(Math.round(val)), 6, padT+(1-i/4)*ih+4); }

  // x labels (sparse)
  const step = Math.max(1, Math.floor(labels.length/6));
  labels.forEach((lab,i)=>{ if(i%step===0 || i===labels.length-1){ ctx.fillText(lab, sx(i)-8, h-6); } });

  // line
  ctx.strokeStyle="#6ea8ff"; ctx.lineWidth=2; ctx.beginPath();
  series.forEach((v,i)=>{ const x=sx(i), y=sy(v); i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
  ctx.stroke();

  // dots
  ctx.fillStyle="#6ea8ff";
  series.forEach((v,i)=>{ const x=sx(i), y=sy(v); ctx.beginPath(); ctx.arc(x,y,2.5,0,Math.PI*2); ctx.fill(); });
}

/* ===== Hooks ===== */
$("#calc").onclick = calculate;
$("#editAgain").onclick = ()=> showStep(1);
$("#reset").onclick = ()=>{ localStorage.removeItem("wizard_aed_v1"); location.reload(); };
load();
showStep(1);
setProgress();
</script>
</body>
</html>
